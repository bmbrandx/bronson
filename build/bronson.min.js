/*! Bronson - v0.1.0 - 2012-08-06
* http://github.com/eclifford/R8/
* Copyright (c) 2012 Eric Clifford; Licensed MIT */
(function(){var a=[].slice,b={}.hasOwnProperty;(function(a,b){return typeof define=="function"&&define.amd?define([],b):a.Bronson=b(a.b)})(this,function(){var c,d,e,f,g;return d=window.Bronson={version:"0.0.1"},require.onError=function(a){var b;if(a.requireType==="timeout")return console.error("Could not load module "+a.requireModules);throw b=a.requireModules&&a.requireModules[0],require.undef(b),a},requirejs.onResourceLoad=function(a,b,c){},c=d.Api={publish:function(a){if(a==null||typeof a!="string")throw new Error("Bronson.Api#publish: a valid channel must be supplied");return d.Core.publish(a,arguments[1])},subscribe:function(a,b,c){if(a==null||typeof a!="string")throw new Error("Bronson.Api#subscribe: a valid subscriber must be supplied");if(b==null||typeof b!="string")throw new Error("Bronson.Api#subscribe: a valid channel must be supplied");if(c!=null&&typeof c!="function")throw new Error("Bronson.Api#subscribe: callback must be a function");if(f.validate(a,b))return d.Core.subscribe(a,b,c);throw new Error("Bronson.Api#subscribe: Subscriber "+a+" not allowed to listen on channel "+b)},unsubscribe:function(a,b){if(a==null||typeof a!="string")throw new Error("Bronson.Api#unsubscribe: a valid subscriber must be supplied");if(b==null||typeof b!="string")throw new Error("Bronson.Api#unsubscribe: a valid channel must be supplied");return d.Core.unsubscribe(a,b)},createModule:function(){var b,c,e,f,g;c=arguments[0],e=3<=arguments.length?a.call(arguments,1,f=arguments.length-1):(f=1,[]),b=arguments[f++];if(!c||typeof c!="string")throw new Error("Bronson.Api#createModule: a valid module alias or path must be supplied");if(b!=null&&typeof b!="function")throw new Error("Bronson.Api#createModule: callback must be a function");return(g=d.Core).createModule.apply(g,[c].concat(a.call(e),[b]))},stopAllModules:function(){return d.Core.stopAllModules()},stopModule:function(a,b){if(!a||typeof a!="string")throw new Error("Bronson.Api#stopModule: a valid module alias or path must be supplied");if(b!=null&&typeof b!="function")throw new Error("Bronson.Api#stopModule: callback must be a function");return d.Core.stopModule(a,b)}},f=d.Permissions={enabled:!1,rules:{},extend:function(a){var b;return b=d.Util.extend(b,a)},validate:function(a,b){var c,d;if(a==null||typeof a!="string")throw new Error("Bronson.Permissions#validate: must provide a valid subscriber");if(b==null||typeof b!="string")throw new Error("Bronson.Permissions#validate: must provide a valid channel");return this.enabled?(c=(d=this.rules[a])!=null?d[b]:void 0,c===void 0?!1:c):!0}},e=d.Core={channels:{},modules:{},publish:function(a){var b,c,d,e,f,g;if(a==null)throw new Error("Bronson.Core#publish: channel must be defined");if(typeof a!="string")throw new Error("Bronson.Core#publish: channel must be a string");if(!this.channels[a])return!0;d=this.channels[a].slice(),b=[].slice.call(arguments,1),g=[];for(e=0,f=d.length;e<f;e++)c=d[e],g.push(c.callback.apply(this,b));return g},subscribe:function(a,b,c){if(a==null||typeof a!="string")throw new Error("Bronson.Core#subscribe: must supply a valid subscriber");if(b==null||typeof b!="string")throw new Error("Bronson.Core#subscribe: must supply a valid channel");if(c!=null&&typeof c!="function")throw new Error("Bronson.Core#subscribe: callback must be a function");return this.channels[b]=this.channels[b]?this.channels[b]:[],this.channels[b].push({subscriber:a,callback:c})},unsubscribe:function(a,b){var c,d,e,f,g,h;g=this.channels[b],h=[];for(c=e=0,f=g.length;e<f;c=++e)d=g[c],d.subscriber===a?h.push(this.channels[b].splice(c,1)):h.push(void 0);return h},unsubscribeAll:function(a){var b,c,d,e,f,g;g=[];for(b in this.channels)if(this.channels.hasOwnProperty(b)){f=this.channels[b];for(c=d=0,e=f.length;d<e;c=++d)a=f[c],a===a&&this.channels[b].splice(c,1);this.channels[b].length===0?g.push(delete this.channels[b]):g.push(void 0)}else g.push(void 0);return g},createModule:function(){var b,c,d,e,f=this;c=arguments[0],d=3<=arguments.length?a.call(arguments,1,e=arguments.length-1):(e=1,[]),b=arguments[e++];if(c==null)throw new Error("Bronson.Core#createModule: moduleId must be defined");if(typeof c!="string")throw new Error("Bronson.Core#createModule: moduleId must be a string");return d=d[0],require([c],function(a){var e;try{return e=new a(d),e.id=c,f.modules[c]=e,b(e)}catch(g){throw new Error("Bronson.Core#createModule: "+g)}})},stopAllModules:function(){var a,b;b=[];for(a in modules)b.push(this.stopModule(a));return b},stopModule:function(a,b){if(a==null||typeof a!="string")throw new Error("Bronson.Core#stopModule: moduleId must be valid");if(this.modules[a]==null)throw new Error("Bronson.Core#stopModule: that moduleId is not loaded");try{require.undef(a),this.unsubscribeAll(a)}catch(c){throw new Error("Bronson.Core#stopModule: "+c)}return b()}},d.Module=function(){function a(){this.initialize.apply(this,arguments)}return a.prototype.id="",a.prototype.disposed=!1,a.prototype.initialize=function(){throw new Error("Bronson.Module#initialize: must override initialize")},a.prototype.dispose=function(){if(this.disposed)return;return d.Core.stopModule(this.id,function(){}),this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},a}(),g=d.Util={extend:function(){var c,d,e,f,g,h,i;e=arguments[0],c=2<=arguments.length?a.call(arguments,1):[];if(e==null)return{};for(h=0,i=c.length;h<i;h++){f=c[h];for(d in f){if(!b.call(f,d))continue;g=f[d],e[d]==null||typeof g!="object"?e[d]=g:e[d]=extend(e[d],g)}}return e}},d})}).call(this);