/*! Bronson - v0.1.0 - 2012-08-07
* http://github.com/eclifford/R8/
* Copyright (c) 2012 Eric Clifford; Licensed MIT */
(function(){var a=[].slice,b={}.hasOwnProperty;(function(a,b){return typeof define=="function"&&define.amd?define([],b):a.Bronson=b(a.b)})(this,function(){var c,d,e,f,g;return d=window.Bronson={version:"0.0.1"},require.onError=function(a){var b;if(a.requireType==="timeout")return console.error("Could not load module "+a.requireModules);throw b=a.requireModules&&a.requireModules[0],require.undef(b),a},requirejs.onResourceLoad=function(a,b,c){},c=d.Api={publish:function(a){return d.Core.publish(a,arguments[1])},subscribe:function(a,b,c){if(f.validate(a,b))return d.Core.subscribe(a,b,c);throw new Error("Bronson.Api#subscribe: Subscriber "+a+" not allowed to listen on event "+b)},unsubscribe:function(a,b,c){return d.Core.unsubscribe(a,b,c)},loadModule:function(){var b,c,e,f,g,h;return e=arguments[0],f=4<=arguments.length?a.call(arguments,1,g=arguments.length-2):(g=1,[]),c=arguments[g++],b=arguments[g++],b==null&&(b=!0),(h=d.Core).loadModule.apply(h,[e,b].concat(a.call(f),[c]))},unloadAllModules:function(){return d.Core.unloadAllModules()},unloadModule:function(a,b){return d.Core.unloadModule(a,b)},startModule:function(a){return d.Core.startModule(moduleId)},stopModule:function(a){return d.Core.stopModule(moduleId)},setPermissions:function(a){return d.Permissions.set(a)},getModulesInfo:function(){return d.Core.modules},getEventsInfo:function(){return d.Core.events}},f=d.Permissions={enabled:!1,rules:{},set:function(a){return this.rules=d.Util.extend(this.rules,a)},validate:function(a,b){var c,d;if(a==null||typeof a!="string")throw new Error("Bronson.Permissions#validate: must provide a valid subscriber");if(b==null||typeof b!="string")throw new Error("Bronson.Permissions#validate: must provide a valid channel");return this.enabled?(c=(d=this.rules[a])!=null?d[b]:void 0,c===void 0?!1:c):!0}},e=d.Core={events:{},modules:{},publish:function(a){var b,c,d,e,f,g;if(a==null)throw new Error("Bronson.Core#publish: event must be defined");if(typeof a!="string")throw new Error("Bronson.Core#publish: event must be a string");if(!this.events[a])return!0;d=this.events[a].slice(),b=[].slice.call(arguments,1),g=[];for(e=0,f=d.length;e<f;e++)c=d[e],g.push(c.callback.apply(this,b));return g},subscribe:function(a,b,c){if(a==null||typeof a!="string")throw new Error("Bronson.Core#subscribe: must supply a valid subscriber");if(b==null||typeof b!="string")throw new Error("Bronson.Core#subscribe: must supply a valid event");if(c!=null&&typeof c!="function")throw new Error("Bronson.Core#subscribe: callback must be a function");return this.events[b]=this.events[b]?this.events[b]:[],this.events[b].push({subscriber:a,callback:c})},unsubscribe:function(a,b,c){var d,e,f,g,h;h=this.events[b];for(d=f=0,g=h.length;f<g;d=++f)e=h[d],e.subscriber===a&&this.events[b].splice(d,1);return c()},unsubscribeAll:function(a,b){var c,d,e,f,g;for(c in this.events)if(this.events.hasOwnProperty(c)){g=this.events[c];for(d=e=0,f=g.length;e<f;d=++e)a=g[d],a===a&&this.events[c].splice(d,1);this.events[c].length===0&&delete this.events[c]}return b()},loadModule:function(){var b,c,d,e,f,g=this;d=arguments[0],e=4<=arguments.length?a.call(arguments,1,f=arguments.length-2):(f=1,[]),c=arguments[f++],b=arguments[f++];if(d==null)throw new Error("Bronson.Core#createModule: module must be defined");if(typeof d!="string")throw new Error("Bronson.Core#createModule: module must be a string");if(b!=null&&typeof b!="boolean")throw new Error("Bronson.Core#createModule: autostart must be a valid boolean");return e=e[0],require(["module",d],function(a,f){var h;try{return h=new f(e),h.id=a.id,g.modules[d]=g.modules[d]?g.modules[d]:[],g.modules[d].push({id:h.id,timeStamp:new Date,start:h.start,stop:h.stop}),b&&h.start(),c(h)}catch(i){throw new Error("Bronson.Core#createModule: "+i)}})},unloadAllModules:function(a){var b;for(b in modules)this.unloadModule(b);return a()},unloadModule:function(a,b){if(a==null||typeof a!="string")throw new Error("Bronson.Core#stopModule: module must be valid");if(this.modules[a]==null)throw new Error("Bronson.Core#stopModule: that module is not loaded");try{require.undef(a),this.unsubscribeAll(a,function(){})}catch(c){throw new Error("Bronson.Core#stopModule: "+c)}return b()},startModule:function(a){var b,c,d,e;e=[];for(c in this.modules)this.modules.hasOwnProperty(c)?e.push(function(){var e,f,g,h;g=this.modules[c],h=[];for(d=e=0,f=g.length;e<f;d=++e)b=g[d],b.id===a?h.push(b.start()):h.push(void 0);return h}.call(this)):e.push(void 0);return e},stopModule:function(a){var b,c,d,e;e=[];for(c in this.modules)this.modules.hasOwnProperty(c)?e.push(function(){var e,f,g,h;g=this.modules[c],h=[];for(d=e=0,f=g.length;e<f;d=++e)b=g[d],b.id===a?h.push(b.stop()):h.push(void 0);return h}.call(this)):e.push(void 0);return e}},d.Module=function(){function a(){this.initialize.apply(this,arguments)}return a.prototype.id="",a.prototype.disposed=!1,a.prototype.initialize=function(){throw new Error("Bronson.Module#initialize: must override initialize")},a.prototype.start=function(){throw new Error("Bronson.Module#start: must override start")},a.prototype.stop=function(){throw new Error("Bronson.Module#stop: must override stop")},a.prototype.dispose=function(){var a,c;if(this.disposed)return;for(c in this){if(!b.call(this,c))continue;a=this[c],a&&typeof a.dispose=="function"&&(a.dispose(),delete this[c])}return this.disposed=!0,typeof Object.freeze=="function"?Object.freeze(this):void 0},a}(),g=d.Util={extend:function(){var c,d,e,f,g,h,i;e=arguments[0],c=2<=arguments.length?a.call(arguments,1):[];if(e==null)return{};for(h=0,i=c.length;h<i;h++){f=c[h];for(d in f){if(!b.call(f,d))continue;g=f[d],e[d]==null||typeof g!="object"?e[d]=g:e[d]=this.extend(e[d],g)}}return e}},d})}).call(this);